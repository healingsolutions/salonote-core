jQuery(function(){jQuery(".character_image_upload").on("click",function(e){var t;e.preventDefault();var a=$(this).attr("rel"),r=a.replace("character_","");if(t)return void t.open();console.log("click:"+a),t=wp.media({title:_wpMediaViewsL10n.mediaLibraryTitle,library:{type:"image"},button:{text:"画像を選択"},multiple:!1,frame:"select",editing:!0}),t.on("ready",function(){}),t.on("select",function(){var e=t.state().get("selection"),i=jQuery("#"+a),c=0,l=[];e.each(function(e){new_id=e.toJSON().id,jQuery.inArray(new_id,l)>-1&&i.find("li#img_"+new_id).remove(),console.log("select"+a),i.val(e.attributes.sizes.medium.url),jQuery('a[rel="'+a+'"]').hide(),jQuery("#"+a+"_asset").html('<div class="character_asset_block"><a href="#" class="character_image_remove" title="画像を削除する"></a><img src="'+e.attributes.sizes.medium.url+'" /><input id="character_'+r+'" type="hidden" name="es_character_upload_images['+r+']" value="'+e.attributes.sizes.medium.url+'" /></div>')})}),t.open()}),jQuery(".character_image_remove").live("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).parents(".character_td").children(".character_image_upload").show(),img_obj=jQuery(this).parents(".character_asset_block").remove()})});